# VendoPunkto

VendoPunkto is a payment processor for cryptocurrencies. It's only goal is to
generate invoices and verifying it's payments, supporting multiple currencies.

Applications can integrate with VendoPunkto and let it handle payments for them.
i.e PoS or ecommerce apps can focus on their logic and delegate payments
to VendoPunkto. When requesting payment to a customer, VendoPunkto's invoice is
displayed where the customer can pay. The payment can be seen on the screen 
as it hits the mempool and your application can continue to do it's business
logic, like delivering a product/service.

It is a self hosted application, meaning that you're always in control of your
funds.
Best efforts will be done to improve privacy of its users and merchants.

Status: **DO NOT USE IN PRODUCTION**

## Free and open source

VendoPunkto is free and open source software, there're no fees and you're always
in control of your funds. Network fees still need to be payed as usual.

By iteself, it does not collect any user information, and will never do.
Although, applications and plugins which integrate with it may do so.

## Open Plugin System

VendoPunkto provides a plugin system where anyone can develop new plugins to
support functionalities on the system.

Currently, two plugin types are supported:

- `wallet`: used to implement currency payments
- `exchange-rates` to obtain exchange rates from different sources

Official implementations will be provided for Monero and Bitcoin wallets, and
some popular exchange rates as well. Since these are also plugins you could 
choose different implementations provided by the community or you could not load
any official plugin at all. They're not part of VendoPunkto's binary.

## Any Crypto could be accepted

We don't judge which currency you'd like to accept, it's an open market and you
should be able to accept any crypto/token you'd like, despite of VendoPunkto
developers, or anyone's opinion for that matter.

We do not consider any crypto to be an "altcoin" and we embrace the fact that
anyone can create and give value to a new currency. If a currency has value to
you, then you are able to accept payments without having VendoPunkto's
developers blessing nor interference.

VendoPunkto will never try to make it harder for plugin developers to implement
their currencies plugin without justified reason.

## Features

- Simple, but not simpler.
- Accept any cryptocurrency payment that are supported by current plugins.
- New currencies can be supported by plugins which can be created by anyone and
    don't require changes in VendoPunkto for them to be distributed
- Invoices can be payed with multiple currencies, at the same time.
    i.e. you can pay an invoice with 20% XMR, 50% BTC and 30% LTC.

**VendoPunkto donesn't collect any user data at all.**

### What is collected?

- Invoice addresses generated by plugins
- Invoice amounts and payment methods
- Transaction Hashes and confirmation amounts

## Architecture

VendoPunkto is a three tier application, where an HTTP server is provided for
multiple frontend clients to consume. Persistance is done with Postgres DB,
although tecnically other DB implementations could be supported.

VendoPunkto server hosts a public and internal API on different ports so that
it's easier for operation security. You can port-foward the public port and
keep the internal port secure on your LAN.

The internal API is consumed by plugins and integrating apps, whereas the public
one is mainly used to display invoices by integrating apps, or to share an invoice

Plugin-to-server and server-to-plugin communication is done via HTTP.
This means that plugins are language-agnostic and easier to develop and build.
There're no fixed dependencies for a plugin, one could implement the HTTP API
"interface" on any programming language that supports listening for HTTP.

A plugin package is provided by VendoPunkto to facilitate the plugin creations;
currently it's only developed for Golang.

## VendoPunkto API
Handles invoices and wallet-integration. It's the software in charge of
communicating with wallets in order to generate new addresses and confirm
payments have been done to those addresses.

It's internal API must not be exposed to the public internet, ideally should not
be exposed to LAN either. Communication could be done at the host level only.

It's public API should be port-forwarded if you want to send links to an
invoice. If you're using POS on your LAN you don't need to port forward anything.

## Multicoin payments

VendoPunkto allows the payee to pay an invoice in any of the current installed
coin wallet plugins.

When an invoice is created, a `total` price and `currency` are provided in order
to define it's value. At this moment, multiple payment methods may be provided as
well. The original `total` and `currency` may only be used to determine the
invoice's value and may not be a payment method by itself. (i.e fiat currencies)

The price of all payment methods will be calculated at the invoice creation 
process using the configured `exchange-rates` plugin.
This exchange rate will be kept throught the life of the invoice.
This may be changed in the future to compensate, in the case of long-lived
invoices, the market volatility.

When the invoice is displayed, the payee can select the payment method
that will be used to perform the payment. A new address is generated by the
payment method's wallet and QR code is displayed for the payee to pay.

## Development

For development you need a Postgress database, plugin implementations for at
at least a coin and exchange rates, Go and Make. To build the web client, npm

The startup order is important, you want to make sure that plugins are started
before VendoPunkto, given that plugins are currently loaded at startup.

To start the database using docker 
```bash
docker-compose up -d vendopunktopostgres
```

There're mock plugin immplementations which can be started with
```bash
make dev-plugin
```

To build and run VendoPunkto API, in a different shell
```bash
# do this once
cd ./spa && npm install && npm run build && cd ../
# and then just
make && make run
```

### Gecko exchange rates
A sample integration is provided with Gecko API for exchange rates.

```bash
make build-rates && make run-rates
```

### Monero Integration

Current support for Monero works using `monero-wallet-rpc`. 
For address generation, currently it's generating Integrated Addresses, but the
idea is that both Integrated Addresses and Subaddresses are supported.
The plugin will
start up an HTTP server that will be used to receive the `tx-notify` callback
from `monero-wallet-rpc`

### VendoPunkto CLI

A CLI is provided as a client while the web client is under development.
The CLI may still be useful for operators.

```bash
make build-cli
```

```bash
$ ./vendopunkto-cli --help
Usage:
  vendopunkto-cli [command]

Available Commands:
  help        Help about any command
  invoices    Manage Invoices

Flags:
  -c, --config string   Config file
  -h, --help            help for vendopunkto-cli
  -H, --host string     The VendoPunkto host URL i.e http://localhost:8080
      --version         version for vendopunkto-cli

Use "vendopunkto-cli [command] --help" for more information about a command.
```

To create invoices
```bash
$ ./vendopunkto-cli invoices create xmr 1
Your invoice has been created and is awaiting payment.
  Invoice ID: bnvvma2cvpn841ekeo8g
  Total: 1 XMR
  Status: Pending 0%
You can pay using any of the following methods:
  XMR 1 xmr-fake-bnvvma2cvpnegdf1k81g
  BTC 0.005 
  BCH 0.01 
```

View an invoice with QR code

```bash
$ ./vendopunkto-cli invoices view bnvvma2cvpn841ekeo8g --qr
Found invoice
  Invoice ID: bnvvma2cvpn841ekeo8g
  Total: 1 XMR
  Status: Pending 0%
You can pay using any of the following methods:
  XMR 1 xmr-fake-bnvvma2cvpnegdf1k81g
  BTC 0.005 
  BCH 0.01 

Printing QR Code for XMR

[redacted]                                                                    

XMR 1
Address: xmr-fake-bnvvma2cvpnegdf1k81g
```

Pay using another payment method, the method's address will be generated at this time
```bash
$ ./vendopunkto-cli invoices view bnvvma2cvpn841ekeo8g --method btc
Found invoice
  Invoice ID: bnvvma2cvpn841ekeo8g
  Total: 1 XMR
  Status: Pending 0%
You can pay using any of the following methods:
  XMR 1 xmr-fake-bnvvma2cvpnegdf1k81g
  BTC 0.005 btc-fake-bnvvmv2cvpnegdf1k820
  BCH 0.01 
```

Confirm a payment manually, useful for development:
```bash
$ ./vendopunkto-cli invoices confirm --tx-hash=fake-hash1 --amount=0.5 --address=xmr-fake-bnvvma2cvpnegdf1k81g
Payment confirmed

# check the invoice
$ ./vendopunkto-cli invoices view bnvvma2cvpn841ekeo8g
Found invoice
  Invoice ID: bnvvma2cvpn841ekeo8g
  Total: 1 XMR
  Status: Pending 0%
You can pay using any of the following methods:
  XMR 1 xmr-fake-bnvvma2cvpnegdf1k81g
  BCH 0.01 
  BTC 0.005 btc-fake-bnvvmv2cvpnegdf1k820
Payments
  0.5 XMR (fake-hash1) (Conf. #0)

# add confirmations
$ ./vendopunkto-cli invoices confirm --tx-hash=fake-hash1 --amount=0.5 --address=xmr-fake-bnvvma2cvpnegdf1k81g --confirmations=1
Payment confirmed

# check the invoice
$ ./vendopunkto-cli invoices view bnvvma2cvpn841ekeo8g
Found invoice
  Invoice ID: bnvvma2cvpn841ekeo8g
  Total: 1 XMR
  Status: Pending 50%
  Remaining: 0.5 XMR
You can pay using any of the following methods:
  XMR 0.5 xmr-fake-bnvvma2cvpnegdf1k81g
  BCH 0.005 
  BTC 0.0025 btc-fake-bnvvmv2cvpnegdf1k820
Payments
  0.5 XMR (fake-hash1) (Conf. #1)

# pay the remaining using BTC
$ ./vendopunkto-cli invoices confirm --tx-hash=fake-btc-hash1 --amount=0.0025 --address=btc-fake-bnvvmv2cvpnegdf1k820 --confirmations=1
Payment confirmed

$ ./vendopunkto-cli invoices view bnvvma2cvpn841ekeo8g
Found invoice
  Invoice ID: bnvvma2cvpn841ekeo8g
  Total: 1 XMR
  Status: Completed 100%
  Remaining: 0 XMR
Payments
  0.5 XMR (fake-hash1) (Conf. #1)
  0.0025 BTC (fake-btc-hash1) (Conf. #1)
```

## License

**VendoPunkto is provided without any warranties** please read the [LICENSE](LICENSE)